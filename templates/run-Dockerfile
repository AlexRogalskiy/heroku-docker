FROM heroku/cedar:14

RUN useradd -d /app -m app
USER app
WORKDIR /app

ENV HOME /app
ENV PATH /app/heroku/node/bin:$PATH
ENV NODE_ENGINE <%= node_engine %>
ENV PORT 3000

RUN mkdir -p /app/heroku
RUN mkdir -p /app/src
RUN curl -s http://s3pository.heroku.com/node/v$NODE_ENGINE/node-v$NODE_ENGINE-linux-x64.tar.gz | tar xvz -C /tmp
RUN mv /tmp/node-v$NODE_ENGINE-linux-x64 /app/heroku/node

WORKDIR /app/src

ONBUILD COPY . /app/src
ONBUILD RUN npm install
ONBUILD EXPOSE 3000
